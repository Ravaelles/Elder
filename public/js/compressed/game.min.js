function confirmDelete(i,t){return i||(i="Are you sure you want to delete?"),confirm(i)?(t||showPleaseWait(),!0):!1}function showPleaseWait(){var i='<div class="modal" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false role="dialog">        <div class="modal-dialog">            <div class="modal-content">                <div class="modal-header">                    <h4 class="modal-title">Please wait...</h4>                </div>                <div class="modal-body">                    <div class="progress">                      <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"                      aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%; height: 40px">                      </div>                    </div>                </div>            </div>        </div>    </div>';$(document.body).append(i),$("#pleaseWaitDialog").modal("show")}function hidePleaseWait(){$("#pleaseWaitDialog").modal("hide")}function scrollToElement(i,t){t||(t=1500),$("html, body").animate({scrollTop:$(i).offset().top},t)}function appendErrorToBody(i){$(document.body).append("<div style='background-color: #a22l color: white;'>"+i+"</div>")}function setCookie(i,t,n){var e=new Date;e.setTime(e.getTime()+1e3*n);var a="expires="+e.toGMTString();document.cookie=i+"="+t+"; "+a}function getCookie(i){for(var t=i+"=",n=document.cookie.split(";"),e=0;e<n.length;e++){for(var a=n[e];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function rand(i,t){return Math.floor(Math.random()*t+i)}function randArray(i){return i[Math.floor(Math.random()*i.length)]}function randElem(i){return i[Math.floor(Math.random()*i.length)]}function stringStartsWith(i,t){return 0===i.lastIndexOf(t,0)}function typeSounds(){$("input").keyup(function(i){playTypeSound()}),$("label").click(function(){playTypeSound()}),$("button").click(function(){playTypeSound()}),$(".create-account-button").click(function(){playTypeSound()})}function playTypeSound(){soundIndex=Math.floor(5*Math.random()+1),$(document.body).append('<audio controls autoplay style="display: none" id="audio"><source src="/sound/terminal/type'+soundIndex+'.mp3" type="audio/mpeg"></audio>')}function EngineView(i,t){this.width=-1,this.height=-1,this.constructor=function(i,t){this.width=i,this.height=t},this.constructor(i,t),this.getType=function(){return this.type}}function buildStyleStringForImg(i,t,n,e,a,s){var o="position: relative; ";if(n)i.marginLeft=e.width()/2-a/2,i.marginTop=e.height()/2-s/2,t._action!==SPEAR_EQUIP&&t._action!==SPEAR_UNEQUIP||(i.marginTop-=18,i.marginLeft-=17);else{if(i.marginLeft=-a/2,i.marginTop=-s,t.isActionWalk()){if(t.isActionWithWeapon(WEAPON_SPEAR))var r=.25,d=.3;else var r=.38,d=.32;var h=s/5;t._dir===DIR_E?i.marginLeft+=a*r:t._dir===DIR_W?i.marginLeft+=-a*r:t._dir===DIR_SE?(i.marginLeft+=a*d,i.marginTop+=s*d):t._dir===DIR_SW?(i.marginLeft-=a*d,i.marginTop+=s*d):t._dir===DIR_NW?(i.marginLeft+=-a*d,i.marginTop+=-s*d+h):t._dir===DIR_NE&&(i.marginLeft+=a*d,i.marginTop+=-s*d+h)}t._action!==SPEAR_EQUIP&&t._action!==SPEAR_UNEQUIP||(t._dir===DIR_SE?(i.marginLeft-=14,i.marginTop+=8):t._dir===DIR_SW?i.marginLeft-=18.5:t._dir===DIR_NE?(i.marginLeft+=18,i.marginTop+=3.5):t._dir===DIR_NW?i.marginLeft+=15:t._dir===DIR_E?(i.marginLeft-=5,i.marginTop+=12):t._dir===DIR_W&&(i.marginLeft+=4))}return i.marginLeft+=t.positionPX,i.marginTop+=t.positionPY,i.marginLeft&&(o+="left:"+i.marginLeft+"px; "),i.marginTop&&(o+="top:"+i.marginTop+"px; ",o+="z-index: "+(i.marginTop+s)+"; "),o}function DIR_RANDOM(){return randElem(DIR_ALL)}function DIR_RANDOM_SOUTH(){return randElem([DIR_SW,DIR_SE])}function DIR_RANDOM_NORTH(){return randElem([DIR_NW,DIR_NE])}function Unit(i){this._id=null,this._sex=null,this._action=null,this._dir=null,this._type=null,this.staticImageDisplayMode=!1,this.marginLeft=0,this.marginTop=0,this.positionPX=0,this.positionPY=0,this._lastAnimationEndsAt=0,this._divSelector=null,this.constructor=function(i){var t;t="string"==typeof i?JSON.parse(i):i,this._id=t.id?t.id:__firstFreeUnitId++,this._sex=t.sex?"n"+t.sex.toLowerCase():MALE,this._action=t.action?t.action:ACTION_IDLE,this._dir=t.dir?t.dir:DIR_SE,this._type=t.type,this._type||alert("Empty unit type passed for new unit"),allUnits[this._id]=this},this.constructor(i),this.display=function(i){function t(i,t){$("#unit-img-"+i).attr("src",t)}this.staticImageDisplayMode=i;var n=this.createImageElement(),e=n.imageElement,a=n.imagePath;this.staticImageDisplayMode||this.createImageWrapper();var s=new Image;return s.unitId=this._id,s.unit=this,s.imageIsLoaded=!1,s.onload=function(n){var s="<script>$('#unit-img-"+this.unitId+"').css('border', '1px solid rgba(255,0,0,0.2)')</script>";NaN+this.unitId+"').css('border', 'none'); }, 1000)</script>",$("#canvas-debug").html(s);var o=$("#unit-img-"+this.unitId).attr("src");if(t(this.unitId,o),!this.imageIsLoaded){var r=this.unit;this.imageIsLoaded=!0,this.src=a;var d=this.width,h=this.height,u=$("#unit-wrapper-"+this.unitId);u.html(e);var _=$("#unit-img-"+this.unitId);r._imageSelector=_,_.attr({imgwidth:d,imgheight:h}),_.css("z-index",r.positionPY);var c=buildStyleStringForImg(this,r,i,u,d,h);c&&_.attr("style",c)}},s.src=a,this},this._queueAnimations=[],this.queueAnimation=function(i,t,n){var e,a=this.timeSinceLastAnimationEndedAgo(),s=a>=-20;if(n||(n=WALK_ANIMATION_LENGTH),t||(t=0),s?(e=0,this._lastAnimationEndsAt=this.timeNow()+t+n):(e=-a,this._lastAnimationEndsAt+=t+e+n),s&&0===this._queueAnimations.length)this._runAnimationNow(i,t,n);else{var o={options:i,animationLength:n,delay:t};this._queueAnimations.push(o)}return this},this._runAnimationNow=function(i,t,n){var e=this;return setTimeout(function(){var t=i.callbackAnimationAfterStart;t&&t(e,i),e._animate(i),setTimeout(function(){var t=i.callbackAnimationEnded;t&&t(e),e.runNextQueuedAnimationIfNeeded()},n,e)},t),this},this.runNextQueuedAnimationIfNeeded=function(){var i=this._queueAnimations.shift();if(void 0!==i){var t=i.options,n=i.animationLength,e=i.delay;this._runAnimationNow(t,e,n)}},this._animate=function(i,t){t||(t=0),i||(i=[]);var n=i.callbackAnimationBeforeStart;n&&n(this);var e=this;return setTimeout(function(){e.handleOptions(i),e.display(e.staticImageDisplayMode)},t),this._lastAnimationStarted+=t,this},this.timeSinceLastAnimationEndedAgo=function(){return this.timeNow()-this._lastAnimationEndsAt},this.timeNow=function(){return(new Date).getTime()},this.animation=function(i,t,n){return i||(i={}),n||(n=1700),(!t||0>t)&&(t=0),this.queueAnimation(i,t,n),this},this.walk=function(i,t){var n=WALK_ANIMATION_LENGTH+ +(0===this._queueAnimations.length?WALK_ANIMATION_MODIFIER_WHEN_FIRST:0);this.timeSinceLastAnimationEndedAgo();return t||(t=0),i||(i=[]),i.callbackAnimationAfterStart=function(i,t){i.convertActionToWalk()},i.callbackAnimationEnded=function(i){i.handleWalkPositionChange(),0===i._queueAnimations.length&&(i.convertActionToIdle(),i._animate())},this.queueAnimation(i,t,n),this},this.convertActionToWalk=function(){return this._action=this._action.replaceAt(1,"b"),this},this.convertActionToIdle=function(){return this._action=this._action.replaceAt(1,"a"),this},this.handleWalkPositionChange=function(){var i=82,t=36,n=0,e=0;return this._dir===DIR_E?n+=i:this._dir===DIR_W?n-=i:this._dir===DIR_SE?(n+=t,e+=t):this._dir===DIR_SW?(n-=t,e+=t):this._dir===DIR_NW?(n-=t,e-=t):this._dir===DIR_NE&&(n+=t,e-=t),this.positionPX+=n,this.positionPY+=e,this},this.equipWeapon=function(i,t){var n={action:window[i+"_EQUIP"]};if(n.callbackAnimationEnded=function(t){t._action=window[i+"_IDLE"]},i===WEAPON_SPEAR)var e=1300;else var e=1300;return this.queueAnimation(n,t,e),this},this.positionRandomly=function(){return this.positionPX=rand(0,engineView.width),this.positionPY=rand(0,engineView.height),this},this.position=function(i,t){return i||t?(this.positionPX=i,this.positionPY=t,this):{x:this.positionPX,y:this.positionPY}},this.createImageElement=function(){var i="unit-img-"+this._id,t=this._id?"id='"+i+"'":"",n="";if(this.isStaticImage())var e=this._type.substring(7),a="/img/nature/"+e+"/"+rand(1,numOfImages[e]),s=a+".png";else{var a=BASE_IMG_DIR+"all/"+this._sex+this._type+this._action+"_"+this._dir,s=a+".gif";n="unit-alive"}var o="<img "+t+" class='"+n+"' src='"+s+"' />";return{imageElement:o,imagePath:s}},this.createImageWrapper=function(){var i="unit-wrapper-"+this._id;null!==this._divSelector?this._divSelector.html("<div class='engine-unit' id='"+i+"'></div>"):($("#canvas").append("<div class='engine-unit' id='"+i+"'></div>"),this._divSelector=$("#canvas #"+i))},this.handleOptions=function(i){return i&&("undefined"!=typeof i.action&&(this._action=i.action),"undefined"!=typeof i.sex&&(this._sex=i.sex),"undefined"!=typeof i.dir&&(this._dir=i.dir),"undefined"!=typeof i.type&&(this._type=i.type)),this},this.dirTowardEast=function(){return-1!==[DIR_E,DIR_SE,DIR_NE].indexOf(this._dir)},this.dirTowardWest=function(){return-1!==[DIR_W,DIR_NW,DIR_SW].indexOf(this._dir)},this.dirTowardNorth=function(){return-1!==[DIR_NW,DIR_NE].indexOf(this._dir)},this.dirTowardSouth=function(){return-1!==[DIR_SW,DIR_SE].indexOf(this._dir)},this.isStaticImage=function(){return null!==this._type&&stringStartsWith(this._type,"nature_")},this.isActionWalk=function(){return"b"===this._action.charAt(1)},this.isActionWithWeapon=function(i){return i===WEAPON_SPEAR?weaponLetter="g":weaponLetter="a",this._action.charAt(0)===weaponLetter.charAt(0)},this.dir=function(i){return void 0===i?this._dir:void(this._dir=i)},this.action=function(i){return void 0===i?this._action:void(this._action=i)}}String.prototype.replaceAt=function(i,t){return this.substr(0,i)+t+this.substr(i+t.length)},ACTION_IDLE="aa",ACTION_WALK="ab",ACTION_CLIMB_UP="ae",ACTION_PICK_UP="ak",ACTION_USE="al",ACTION_DODGE="an",ACTION_HIT="ao",ACTION_HIT2="ap",ACTION_HAND_COMBAT="aq",ACTION_KICK="ar",ACTION_THROW="as",ACTION_RUN="at",ACTION_RANDOM_STATIC="RANDOM_STATIC",SPEAR_IDLE="ga",SPEAR_WALK="gb",SPEAR_EQUIP="gc",SPEAR_UNEQUIP="gd",SPEAR_DODGE="ge",SPEAR_THRUST="gf",SPEAR_THROW="gm",SPEAR_RANDOM="RANDOM_SPEAR",WEAPON_SPEAR="SPEAR",WEAPON_10MM_PISTOL="10MM",DIR_W="w",DIR_E="e",DIR_NW="nw",DIR_NE="ne",DIR_SW="sw",DIR_SE="se",DIR_ALL=[DIR_W,DIR_E,DIR_NW,DIR_NE,DIR_SW,DIR_SE],WARRIOR_MALE="warr",WARRIOR_FEMALE="prim",SEX_GIRL="/img/special/sex-girl.png",NATURE_TREE="nature_tree",NATURE_GRASS="nature_grass",MALE="nm",FEMALE="nf";var BASE_IMG_DIR="/img/critter/",WALK_ANIMATION_LENGTH=800,WALK_ANIMATION_MODIFIER_WHEN_FIRST=100,allUnits=[],numOfImages=[];numOfImages.grass=5,numOfImages.misc=5,numOfImages.tree=6,__firstFreeUnitId=100;