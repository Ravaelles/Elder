function confirmDelete(t,e){return t||(t="Are you sure you want to delete?"),!!confirm(t)&&(e||showPleaseWait(),!0)}function showPleaseWait(){var t='<div class="modal" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false role="dialog">        <div class="modal-dialog">            <div class="modal-content">                <div class="modal-header">                    <h4 class="modal-title">Please wait...</h4>                </div>                <div class="modal-body">                    <div class="progress">                      <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"                      aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%; height: 40px">                      </div>                    </div>                </div>            </div>        </div>    </div>';$(document.body).append(t),$("#pleaseWaitDialog").modal("show")}function hidePleaseWait(){$("#pleaseWaitDialog").modal("hide")}function scrollToElement(t,e){e||(e=1500),$("html, body").animate({scrollTop:$(t).offset().top},e)}function appendErrorToBody(t){$(document.body).append("<div style='background-color: #a22l color: white;'>"+t+"</div>")}function setCookie(t,e,i){var n=new Date;n.setTime(n.getTime()+1e3*i);var o="expires="+n.toGMTString();document.cookie=t+"="+e+"; "+o}function getCookie(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}function rand(t,e){return Math.floor(Math.random()*e+t)}function randArray(t){return t[Math.floor(Math.random()*t.length)]}function randElem(t){return t[Math.floor(Math.random()*t.length)]}function stringStartsWith(t,e){return 0===t.lastIndexOf(e,0)}function typeSounds(){$("input").keyup(function(t){playTypeSound()}),$("label").click(function(){playTypeSound()}),$("button").click(function(){playTypeSound()}),$(".create-account-button").click(function(){playTypeSound()})}function playTypeSound(){soundIndex=Math.floor(5*Math.random()+1),$(document.body).append('<audio controls autoplay style="display: none" id="audio"><source src="/sound/terminal/type'+soundIndex+'.mp3" type="audio/mpeg"></audio>')}function EngineView(t,e){this.width=-1,this.height=-1,this.constructor=function(t,e){this.width=t,this.height=e},this.constructor(t,e),this.getType=function(){return this.type}}function buildStyleStringForImg(t,e,i,n,o,a){var r="position: relative; ";if(i)t.marginLeft=n.width()/2-o/2,t.marginTop=n.height()/2-a/2,e._action!==SPEAR_EQUIP&&e._action!==SPEAR_UNEQUIP||(t.marginTop-=18,t.marginLeft-=17);else{if(t.marginLeft=-o/2,t.marginTop=-a,e.isActionWalk()){if(e.isActionWithWeapon(WEAPON_SPEAR))var s=.25,l=.3;else var s=.38,l=.32;var _=a/5;e._dir===DIR_E?t.marginLeft+=o*s:e._dir===DIR_W?t.marginLeft+=-o*s:e._dir===DIR_SE?(t.marginLeft+=o*l,t.marginTop+=a*l):e._dir===DIR_SW?(t.marginLeft-=o*l,t.marginTop+=a*l):e._dir===DIR_NW?(t.marginLeft+=-o*l,t.marginTop+=-a*l+_):e._dir===DIR_NE&&(t.marginLeft+=o*l,t.marginTop+=-a*l+_)}e._action!==SPEAR_EQUIP&&e._action!==SPEAR_UNEQUIP||(e._dir===DIR_SE?(t.marginLeft-=14,t.marginTop+=8):e._dir===DIR_SW?t.marginLeft-=18.5:e._dir===DIR_NE?(t.marginLeft+=18,t.marginTop+=3.5):e._dir===DIR_NW?t.marginLeft+=15:e._dir===DIR_E?(t.marginLeft-=5,t.marginTop+=12):e._dir===DIR_W&&(t.marginLeft+=4))}return t.marginLeft+=e.positionPX,t.marginTop+=e.positionPY,t.marginLeft&&(r+="left:"+t.marginLeft+"px; "),t.marginTop&&(r+="top:"+t.marginTop+"px; ",r+="z-index: "+(t.marginTop+a)+"; "),r}function DIR_RANDOM(){return randElem(DIR_ALL)}function DIR_RANDOM_SOUTH(){return randElem([DIR_SW,DIR_SE])}function DIR_RANDOM_NORTH(){return randElem([DIR_NW,DIR_NE])}function Unit(t){this._id=null,this._sex=null,this._action=null,this._dir=null,this._type=null,this.staticImageDisplayMode=!1,this.marginLeft=0,this.marginTop=0,this.positionPX=0,this.positionPY=0,this._lastAnimationEndsAt=0,this._divSelector=null,this.constructor=function(t){var e;e="string"==typeof t?JSON.parse(t):t,this._id=e.id?e.id:__firstFreeUnitId++,this._sex=e.sex?"n"+e.sex.toLowerCase():MALE,this._action=e.action?e.action:ACTION_IDLE,this._dir=e.dir?e.dir:DIR_SE,this._type=e.type,this._type||alert("Empty unit type passed for new unit"),allUnits[this._id]=this},this.constructor(t),this.display=function(t){function e(t,e){$("#unit-img-"+t).attr("src",e)}this.staticImageDisplayMode=t;var i=this.createImageElement(),n=i.imageElement,o=i.imagePath;this.staticImageDisplayMode||this.createImageWrapper();var a=new Image;return a.unitId=this._id,a.unit=this,a.imageIsLoaded=!1,a.onload=function(i){var a="<script>$('#unit-img-"+this.unitId+"').css('border', '1px solid rgba(255,0,0,0.2)')</script>";NaN+this.unitId+"').css('border', 'none'); }, 1000)</script>",$("#canvas-debug").html(a);var r=$("#unit-img-"+this.unitId).attr("src");if(e(this.unitId,r),!this.imageIsLoaded){var s=this.unit;this.imageIsLoaded=!0,this.src=o;var l=this.width,_=this.height,d=$("#unit-wrapper-"+this.unitId);d.html(n);var m=$("#unit-img-"+this.unitId);s._imageSelector=m,m.attr({imgwidth:l,imgheight:_}),m.css("z-index",s.positionPY);var u=buildStyleStringForImg(this,s,t,d,l,_);u&&m.attr("style",u)}},a.src=o,this},this._queueAnimations=[],this.queueAnimation=function(t,e,i){var n,o=this.timeSinceLastAnimationEndedAgo(),a=o>=-20;if(i||(i=WALK_ANIMATION_LENGTH),e||(e=0),a?(n=0,this._lastAnimationEndsAt=this.timeNow()+e+i):(n=-o,this._lastAnimationEndsAt+=e+n+i),a&&0===this._queueAnimations.length)this._runAnimationNow(t,e,i);else{var r={options:t,animationLength:i,delay:e};this._queueAnimations.push(r)}return this},this._runAnimationNow=function(t,e,i){var n=this;return setTimeout(function(){var e=t.callbackAnimationAfterStart;e&&e(n,t),n._animate(t),setTimeout(function(){var e=t.callbackAnimationEnded;e&&e(n),n.runNextQueuedAnimationIfNeeded()},i,n)},e),this},this.runNextQueuedAnimationIfNeeded=function(){var t=this._queueAnimations.shift();if(void 0!==t){var e=t.options,i=t.animationLength,n=t.delay;this._runAnimationNow(e,n,i)}},this._animate=function(t,e){e||(e=0),t||(t=[]);var i=t.callbackAnimationBeforeStart;i&&i(this);var n=this;return setTimeout(function(){n.handleOptions(t),n.display(n.staticImageDisplayMode)},e),this._lastAnimationStarted+=e,this},this.timeSinceLastAnimationEndedAgo=function(){return this.timeNow()-this._lastAnimationEndsAt},this.timeNow=function(){return(new Date).getTime()},this.animation=function(t,e,i){return t||(t={}),i||(i=1700),(!e||e<0)&&(e=0),this.queueAnimation(t,e,i),this},this.walk=function(t,e){var i=WALK_ANIMATION_LENGTH+ +(0===this._queueAnimations.length?WALK_ANIMATION_MODIFIER_WHEN_FIRST:0);this.timeSinceLastAnimationEndedAgo();return e||(e=0),t||(t=[]),t.callbackAnimationAfterStart=function(t,e){t.convertActionToWalk()},t.callbackAnimationEnded=function(t){t.handleWalkPositionChange(),0===t._queueAnimations.length&&(t.convertActionToIdle(),t._animate())},this.queueAnimation(t,e,i),this},this.convertActionToWalk=function(){return this._action=this._action.replaceAt(1,"b"),this},this.convertActionToIdle=function(){return this._action=this._action.replaceAt(1,"a"),this},this.handleWalkPositionChange=function(){var t=82,e=36,i=0,n=0;return this._dir===DIR_E?i+=t:this._dir===DIR_W?i-=t:this._dir===DIR_SE?(i+=e,n+=e):this._dir===DIR_SW?(i-=e,n+=e):this._dir===DIR_NW?(i-=e,n-=e):this._dir===DIR_NE&&(i+=e,n-=e),this.positionPX+=i,this.positionPY+=n,this},this.equipWeapon=function(t,e){var i={action:window[t+"_EQUIP"]};if(i.callbackAnimationEnded=function(e){e._action=window[t+"_IDLE"]},t===WEAPON_SPEAR)var n=1300;else var n=1300;return this.queueAnimation(i,e,n),this},this.positionRandomly=function(){return this.positionPX=rand(0,engineView.width),this.positionPY=rand(0,engineView.height),this},this.position=function(t,e){return t||e?(this.positionPX=t,this.positionPY=e,this):{x:this.positionPX,y:this.positionPY}},this.createImageElement=function(){var t="unit-img-"+this._id,e=this._id?"id='"+t+"'":"",i="";if(this.isStaticImage())var n=this._type.substring(7),o="/img/nature/"+n+"/"+rand(1,numOfImages[n]),a=o+".png";else{var o=BASE_IMG_DIR+"all/"+this._sex+this._type+this._action+"_"+this._dir,a=o+".gif";i="unit-alive"}var r="<img "+e+" class='"+i+"' src='"+a+"' />";return{imageElement:r,imagePath:a}},this.createImageWrapper=function(){var t="unit-wrapper-"+this._id;null!==this._divSelector?this._divSelector.html("<div class='engine-unit' id='"+t+"'></div>"):($("#canvas").append("<div class='engine-unit' id='"+t+"'></div>"),this._divSelector=$("#canvas #"+t))},this.handleOptions=function(t){return t&&("undefined"!=typeof t.action&&(this._action=t.action),"undefined"!=typeof t.sex&&(this._sex=t.sex),"undefined"!=typeof t.dir&&(this._dir=t.dir),"undefined"!=typeof t.type&&(this._type=t.type)),this},this.dirTowardEast=function(){return[DIR_E,DIR_SE,DIR_NE].indexOf(this._dir)!==-1},this.dirTowardWest=function(){return[DIR_W,DIR_NW,DIR_SW].indexOf(this._dir)!==-1},this.dirTowardNorth=function(){return[DIR_NW,DIR_NE].indexOf(this._dir)!==-1},this.dirTowardSouth=function(){return[DIR_SW,DIR_SE].indexOf(this._dir)!==-1},this.isStaticImage=function(){return null!==this._type&&stringStartsWith(this._type,"nature_")},this.isActionWalk=function(){return"b"===this._action.charAt(1)},this.isActionWithWeapon=function(t){return t===WEAPON_SPEAR?weaponLetter="g":weaponLetter="a",this._action.charAt(0)===weaponLetter.charAt(0)},this.dir=function(t){return void 0===t?this._dir:void(this._dir=t)},this.action=function(t){return void 0===t?this._action:void(this._action=t)}}function isDefined(t){return"undefined"!=typeof t}function isUndefined(t){return"undefined"==typeof t}function cloneObject(t){return JSON.parse(JSON.stringify(t))}function getMapCoordinatesFromScreenClick(t){var e=t.pageX-WORLDMAP_CANVAS_MARGIN_LEFT,i=t.pageY-WORLDMAP_CANVAS_MARGIN_TOP;return getMapCoordinatesFromCanvasCoordinates(e,i)}function getMapCoordinatesFromCanvasCoordinates(t,e){var i=getMapOffsetPixelsX()*getWorldmapZoom(),n=WORLDMAP_CANVAS_WIDTH*getWorldmapZoom(),o=t/WORLDMAP_CANVAS_WIDTH,a=getMapOffsetPixelsY()*getWorldmapZoom(),r=WORLDMAP_CANVAS_HEIGHT*getWorldmapZoom(),s=e/WORLDMAP_CANVAS_HEIGHT,l=parseInt(i+o*n),_=parseInt(a+s*r);return{mapX:l,mapY:_}}function getCanvasCoordinatesFromMapCoordinates(t,e){return{canvasX:WORLDMAP_CANVAS_MARGIN_LEFT+t/getWorldmapZoom()-getMapOffsetPixelsX()+2,canvasY:WORLDMAP_CANVAS_MARGIN_TOP+e/getWorldmapZoom()-getMapOffsetPixelsY()+1}}function getCurrentTopLeftPointMapCoordinates(){return getMapCoordinatesFromCanvasCoordinates(0,0)}function coordinatesToString(t){return"canvasX"in t?"["+t.canvasX+","+t.canvasY+"]":"["+t.mapX+","+t.mapY+"]"}function HtmlElement(t,e){this._id=null,this._selector=null,this._top=null,this._left=null,this._htmlDOM=null,this._styleString=null,this._htmlString=null,this.constructor=function(t,e){this._id=__firstFreeWorldmapElementId++,this._htmlDOM=document.createElement("div"),this._left=t,this._top=e},this.constructor(t,e),this.getId=function(){return this._id},this.getSelector=function(){return null===this._selector&&(this._selector=$("#html-element-"+this._id)),this._selector},this.setStyle=function(t){this._styleString=t,this._htmlDOM.setAttribute("id","html-element-"+this._id),this._htmlDOM.setAttribute("style",t)},this.getHtml=function(){return null===this._htmlString&&this.prepareHtml(),this._htmlString},this.prepareHtml=function(){this.updateHtmlDOMPosition(),this._htmlString=this._htmlDOM.outerHTML},this.updateHtmlDOMPosition=function(){var t=this._styleString;t+="top:"+this._top+"px;",t+="left:"+this._left+"px;",this._htmlDOM.setAttribute("style",t)},this.translate=function(t,e){this._left+=t,this._top+=e,this.getSelector().css({left:this._left+"px",top:this._top+"px"})}}function initializeWorldmapEvents(){$(".worldmap-location").mousedown(function(t){mapMouseDown(t),t.stopPropagation()}).mouseup(function(t){mapMouseUp(t),t.stopPropagation()}).mousemove(function(t){mapMouseMove(t),t.stopPropagation()}),$(".worldmap").mousedown(function(t){mapMouseDown(t)}).mouseup(function(t){mapMouseUp(t)}).mousemove(function(t){mapMouseMove(t)}).mousewheel(function(t){mapScroll(t)}).mouseleave(function(t){mapMouseLeave(t)}).contextmenu(function(t){FORBID_RIGHT_CLICK&&t.preventDefault()})}function mapMouseDown(t){worldmap=$(".worldmap"),2===t.button,mousePreviousPosition=t,mouseIsClicked=!0,mouseHasMoved=!1}function mapMouseUp(t){mouseHasMoved||mapClick(t),mouseIsClicked=!1,mousePreviousPosition=null,mouseHasMoved=!1}function mapMouseMove(t){mouseIsClicked&&(mouseHasMoved=!0),mouseIsClicked&&null!=mousePreviousPosition&&(translationVector=moveWorldmapBackgroundImage(t),moveWorldmapObjects(translationVector)),mousePreviousPosition=t,worldmapMessageForever("Mouse points to "+coordinatesToString(getMapCoordinatesFromScreenClick(t)),"mouse-cords")}function mapScroll(t){var e=t.deltaY;e>=1?changeZoom(t,!1):e<=-1&&changeZoom(t,!0),mapMouseMove(t)}function mapMouseLeave(t){mouseIsClicked&&(mapMouseUp(t),mouseIsClicked=!1)}function mapClick(t){var e=getMapCoordinatesFromScreenClick(t);gameLog("<span>["+e.mapX+","+e.mapY+"]</span> is unknown wasteland, not very hospitable place.")}function initializeWorldmapLocations(){recalculateWorldmapLocationVariables(),worldmapLocations.forEach(function(t,e){getWorldmap().append(createHtmlFromLocationJson(t,e))})}function createHtmlFromLocationJson(t,e){var i=t._id,n=t.name,o=getCanvasCoordinatesFromMapCoordinates(t.location.x,t.location.y),a="top:"+(o.canvasY-WORLDMAP_LOCATION_SIZE/2)+"px;left:"+(o.canvasX-WORLDMAP_LOCATION_SIZE/2)+"px;width:"+WORLDMAP_LOCATION_SIZE+"px;height:"+WORLDMAP_LOCATION_SIZE+"px",r="margin-top:"+WORLDMAP_LOCATION_LABEL_MARGIN_TOP+"px;margin-left:"+WORLDMAP_LOCATION_LABEL_MARGIN_LEFT+"px";return'<div class="worldmap-location" id="worldmap-location-'+i+'" variableName="worldmapLocations" variableIndex="'+e+'" style="'+a+'"><label style="'+r+'">'+n+"</label></div>"}function recalculateWorldmapLocationVariables(){WORLDMAP_LOCATION_SIZE=_WORLDMAP_LOCATION_SIZE_MODIFIER/getWorldmapZoom(),WORLDMAP_LOCATION_BORDER_WIDTH=1.5,WORLDMAP_LOCATION_LABEL_MARGIN_TOP=_WORLDMAP_LOCATION_SIZE_MODIFIER/getWorldmapZoom()*1.02,WORLDMAP_LOCATION_LABEL_MARGIN_LEFT=-_WORLDMAP_LOCATION_LABEL_WIDTH/2+WORLDMAP_LOCATION_SIZE/2-WORLDMAP_LOCATION_BORDER_WIDTH+1}function gameLog(t){$(".game-log p").css("opacity","0.7"),$(".game-log").prepend("<p style='display: none' class='game-log-invisible'><span class='dot'>â€¢</span> "+t+"</p>"),$(".game-log .game-log-invisible").slideDown(700)}function worldmapMessageForever(t,e,i){if("undefined"!=typeof e)return worldmapMessage(t,i,e)}function worldmapMessage(t,e,i){e&&(e="color: "+e);var n="game-message-"+(isDefined(i)?i:_worldmapMessageFirstFreeId++);if(i){var o=$("#"+n);if(o.length>0)return void o.text(t)}$(".game-messages").append("<div class='game-message' id='"+n+"' style='width: "+WORLDMAP_CANVAS_WIDTH+"px;"+e+";opacity:1.0'>"+t+"</div>"),i||setTimeout(function(){_dimMessageWithTime(n)},_WORLDMAP_MESSAGE_SHOW_TIME)}function _dimMessageWithTime(t){var e=$("#"+t),i=e.css("opacity");if(i<=0){var n=400;e.hide(n),setTimeout(function(){e.remove()},n)}else e.css("opacity",e.css("opacity")-.03),setTimeout(function(){_dimMessageWithTime(t)},_WORLDMAP_MESSAGE_DIM_INTERVAL+100*i)}function moveWorldmapBackgroundImage(t,e){if(isUndefined(e))var i=t.pageX-mousePreviousPosition.pageX,n=t.pageY-mousePreviousPosition.pageY;else var i=t,n=e;var o=-1*getMapOffsetPixelsX(),a=-1*getMapOffsetPixelsY();if(deltaImagePosX=i,deltaImagePosY=n,o+=deltaImagePosX,a+=deltaImagePosY,imagePosXWithScreenWidth=o-WORLDMAP_CANVAS_WIDTH,imagePosYWithScreenHeight=a-WORLDMAP_CANVAS_HEIGHT,o>0){var r=o;o=0,deltaImagePosX-=r-o}else if(imagePosXWithScreenWidth<=-WORLDMAP_WIDTH/getWorldmapZoom()){var r=o;o=-WORLDMAP_WIDTH/getWorldmapZoom()+WORLDMAP_CANVAS_WIDTH,deltaImagePosX-=r-o}if(a>0){var s=a;a=0,deltaImagePosY-=s-a}else if(imagePosYWithScreenHeight<=-WORLDMAP_HEIGHT/getWorldmapZoom()){var s=a;a=-WORLDMAP_HEIGHT/getWorldmapZoom()+WORLDMAP_CANVAS_HEIGHT,deltaImagePosY-=s-a}return updateViewRectangle(-1*o,-1*a),{dx:deltaImagePosX,dy:deltaImagePosY}}function moveWorldmapObjects(t){var e=getAllWorldmapObjects();for(var i in e)var n=e[i];var o=$(".worldmap-location");$.each(o,function(e,i){var n=$("#"+i.id);n.css({top:parseFloat(n.css("top"))+t.dy,left:parseFloat(n.css("left"))+t.dx})}),$.each(_allWorldmapObjects,function(e,i){i.translate(t.dx,t.dy)})}function WorldmapObject(t){this._id=null,this._x=null,this._y=null,this._x2=null,this._y2=null,this._htmlElements=[],this.constructor=function(t){this._id=__firstFreeWorldmapObjectId++;for(var e in t){var i=t[e];e="_"+e,this.fieldName=i}},this.constructor(t),this.getId=function(){return this._id},this.addHtmlElement=function(t){var e=t.getId();return this._htmlElements[e]=t,this},this.getHtmlElements=function(){return this._htmlElements.slice()},this.setCoordinates=function(t,e){return this._x=t,this._y=e,this},this.setEndCoordinates=function(t,e){return this._x2=t,this._y2=e,this},this.getCoordinates=function(){return{x:this._x,y:this._y}},this.translate=function(t,e){this._x+=t,this._y+=e;for(var i in this._htmlElements){var n=this._htmlElements[i];n.translate(t,e)}}}function getAllWorldmapObjects(){return _allWorldmapObjects}function addWorldmapObject(t){var e=t.getHtmlElements();for(var i in e){var n=e[i];getWorldmap().append(n.getHtml())}_allWorldmapObjects[t.getId()]=t}function paintTest(){testLineX1=_WORLDMAP_IMAGE_INITIAL_X+300,testLineY1=_WORLDMAP_IMAGE_INITIAL_Y+400,testLineX2=testLineX1,testLineY2=testLineY1;WEngine_paintLine(testLineX1,testLineY1,testLineX2,testLineY2);setTimeout(function(){},100)}function WEngine_paintLine(t,e,i,n,o,a){canvasCoords=getCanvasCoordinatesFromMapCoordinates(t,e),t=canvasCoords.canvasX,e=canvasCoords.canvasY,canvasCoords=getCanvasCoordinatesFromMapCoordinates(i,n),i=canvasCoords.canvasX,n=canvasCoords.canvasY;var r=_WEngine_getLine(t,e,i,n,o);return isUndefined(a)?(a=new WorldmapObject,a.setCoordinates(t,e),a.setEndCoordinates(i,n),a.addHtmlElement(r),addWorldmapObject(a),a):r}function WEngine_paintRectangleFromArray(t,e){return WEngine_paintRectangle(t.x,t.y,t.x+t.width,t.y+t.height,e)}function WEngine_paintRectangle(t,e,i,n,o){var a=new WorldmapObject;return a.setCoordinates(t,e),a.setEndCoordinates(i,n),a.addHtmlElement(WEngine_paintLine(t,e,i,e,o,a)),a.addHtmlElement(WEngine_paintLine(t,n,i,n,o,a)),a.addHtmlElement(WEngine_paintLine(t,e,t,n,o,a)),a.addHtmlElement(WEngine_paintLine(i,e,i,n,o,a)),addWorldmapObject(a),a}function _WEngine_getLine(t,e,i,n,o){var a=t-i,r=e-n,s=Math.sqrt(a*a+r*r),l=(t+i)/2,_=(e+n)/2,d=l-s/2,m=_,u=Math.PI-Math.atan2(-r,a);return _WEngine_getLine_element(d,m,s,u,o)}function _WEngine_getLine_element(t,e,i,n,o){var a=new HtmlElement(t,e),r="border: "+WENGINE_DEFAULT_LINE_WIDTH+"px dashed red; width: "+i+"px; height: 0px; -moz-transform: rotate("+n+"rad); -webkit-transform: rotate("+n+"rad); -o-transform: rotate("+n+"rad); -ms-transform: rotate("+n+"rad); position: absolute; ";if(isDefined(o))for(var s in o)r+=s+":"+o[s]+";";return a.setStyle(r),a}function initializeWorldmapView(){_currentWorldmapImageWidth=_WORLDMAP_IMAGE_INITIAL_WIDTH,_currentWorldmapImageHeight=_currentWorldmapImageWidth*WORLDMAP_CANVAS_WIDTH/WORLDMAP_CANVAS_HEIGHT,_worldmapViewRectangle={x:_WORLDMAP_IMAGE_INITIAL_X,y:_WORLDMAP_IMAGE_INITIAL_Y,width:WORLDMAP_CANVAS_WIDTH,height:WORLDMAP_CANVAS_HEIGHT},initializeWorldmapZoom(),updateViewRectangle(_worldmapViewRectangle.x,_worldmapViewRectangle.y)}function getWorldmapViewRectangle(){return cloneObject(_worldmapViewRectangle)}function getWorldmapViewRectangleWidth(){return _worldmapViewRectangle.width}function getWorldmapViewRectangleHeight(){return _worldmapViewRectangle.height}function getMapOffsetPixelsX(){return _worldmapViewRectangle.x}function getMapOffsetPixelsY(){return _worldmapViewRectangle.y}function updateViewRectangle(t,e){if(isDefined(t)){var i,n;null!=t?(i=Math.abs(t),n=Math.abs(e)):(i=Math.abs(t.x),n=Math.abs(e.y)),_worldmapViewRectangle.x=i,_worldmapViewRectangle.y=n,getWorldmap().css({"background-position":-i+"px "+-n+"px"})}_worldmapViewRectangle.width=WORLDMAP_CANVAS_WIDTH/getWorldmapZoom(),_worldmapViewRectangle.height=WORLDMAP_CANVAS_HEIGHT/getWorldmapZoom(),getWorldmap().css({"background-size":_currentWorldmapImageWidth+"px auto"})}function initializeWorldmapZoom(){_recalculateZoom()}function getWorldmapZoom(){return _zoom}function changeZoom(t,e){_zoomMessageWasShown=!1,_worldmapZoomsToProceedCounter=_WORLDMAP_ZOOM_ANIMATIONS,_delayChangeZoom(t,e)}function _delayChangeZoom(t,e){setTimeout(function(){_processZoom(t,e)},_WORLDMAP_ZOOM_INTERVAL)}function _processZoom(t,e){if(_worldmapZoomsToProceedCounter>0){if(_worldmapZoomsToProceedCounter--,_oldMapImageWidth=_currentWorldmapImageWidth,_oldZoom=_zoom,_oldWorldmapViewRectangle=getWorldmapViewRectangle(),!_changeZoomAndCheckIfAllowed(t,e))return _revertZoom();updateViewRectangle(),_afterZoomMakeSureWeReInbound(t,e),_afterZoomUpdateMapLocations(),mapMouseMove(t),_delayChangeZoom(t,e)}}function _afterZoomMakeSureWeReInbound(t,e){var i=getCurrentTopLeftPointMapCoordinates(),n=(i.mapX-_oldWorldmapViewRectangle.x,i.mapY-_oldWorldmapViewRectangle.y,2);e?moveWorldmapBackgroundImage(_zoomStep/n,_zoomStep/n):moveWorldmapBackgroundImage(_zoomStep/-n,_zoomStep/-n)}function _afterZoomUpdateMapLocations(){recalculateWorldmapLocationVariables();var t=$(".worldmap-location");$.each(t,function(t,e){var i=$("#"+e.id),n=i.attr("variableName"),o=i.attr("variableIndex"),a=window[n][o],r=getCanvasCoordinatesFromMapCoordinates(a.location.x,a.location.y);i.css({width:WORLDMAP_LOCATION_SIZE+"px",height:WORLDMAP_LOCATION_SIZE+"px",left:r.canvasX-WORLDMAP_LOCATION_SIZE/2,top:r.canvasY-WORLDMAP_LOCATION_SIZE/2,"border-width":WORLDMAP_LOCATION_BORDER_WIDTH+"px"})}),$(".worldmap-location label").css({"margin-top":WORLDMAP_LOCATION_LABEL_MARGIN_TOP+"px","margin-left":WORLDMAP_LOCATION_LABEL_MARGIN_LEFT+"px"})}function _recalculateZoom(){_zoom=WORLDMAP_WIDTH/_currentWorldmapImageWidth}function _changeZoomAndCheckIfAllowed(t,e){e?_currentWorldmapImageWidth-=_zoomStep:_currentWorldmapImageWidth+=_zoomStep,_recalculateZoom();var i=_zoom<_MIN_ZOOM_VALUE,n=_currentWorldmapImageWidth<WORLDMAP_CANVAS_WIDTH;return i?(worldmapMessage("Maximum zoom reached!","#f35"),_zoomMessageWasShown=!0,!1):!n||(worldmapMessage("Maximum zoom out reached!","#2f3"),_zoomMessageWasShown=!0,!1)}function _revertZoom(){_currentWorldmapImageWidth=_oldMapImageWidth,_zoom=_oldZoom,_worldmapViewRectangle=_oldWorldmapViewRectangle}function initializeWorldmap(){WORLDMAP_CANVAS_WIDTH=$(".worldmap").width(),WORLDMAP_CANVAS_HEIGHT=$(".content-wrapper").height(),WORLDMAP_CANVAS_MARGIN_LEFT=$(".sidebar").width(),WORLDMAP_CANVAS_MARGIN_TOP=$(".main-header").height();$(".worldmap");getWorldmap().css("background-image",'url("/img/map/map.jpg")')}function getWorldmap(){return null!=worldmap?worldmap:worldmap=$(".worldmap")}String.prototype.replaceAt=function(t,e){return this.substr(0,t)+e+this.substr(t+e.length)},ACTION_IDLE="aa",ACTION_WALK="ab",ACTION_CLIMB_UP="ae",ACTION_PICK_UP="ak",ACTION_USE="al",ACTION_DODGE="an",ACTION_HIT="ao",ACTION_HIT2="ap",ACTION_HAND_COMBAT="aq",ACTION_KICK="ar",ACTION_THROW="as",ACTION_RUN="at",ACTION_RANDOM_STATIC="RANDOM_STATIC",SPEAR_IDLE="ga",SPEAR_WALK="gb",SPEAR_EQUIP="gc",SPEAR_UNEQUIP="gd",SPEAR_DODGE="ge",SPEAR_THRUST="gf",SPEAR_THROW="gm",SPEAR_RANDOM="RANDOM_SPEAR",WEAPON_SPEAR="SPEAR",WEAPON_10MM_PISTOL="10MM",DIR_W="w",DIR_E="e",DIR_NW="nw",DIR_NE="ne",DIR_SW="sw",DIR_SE="se",DIR_ALL=[DIR_W,DIR_E,DIR_NW,DIR_NE,DIR_SW,DIR_SE],WARRIOR_MALE="warr",WARRIOR_FEMALE="prim",SEX_GIRL="/img/special/sex-girl.png",NATURE_TREE="nature_tree",NATURE_GRASS="nature_grass",MALE="nm",FEMALE="nf";var BASE_IMG_DIR="/img/critter/",WALK_ANIMATION_LENGTH=800,WALK_ANIMATION_MODIFIER_WHEN_FIRST=100,allUnits=[],numOfImages=[];numOfImages.grass=5,numOfImages.misc=5,numOfImages.tree=6,__firstFreeUnitId=100,__firstFreeWorldmapElementId=1;var FORBID_RIGHT_CLICK=!1,mouseIsClicked=!1,mousePreviousPosition=null,mouseHasMoved=!1,WORLDMAP_LOCATION_SIZE=null,WORLDMAP_LOCATION_LABEL_MARGIN_LEFT=null,WORLDMAP_LOCATION_LABEL_MARGIN_TOP=null,_WORLDMAP_LOCATION_SIZE_MODIFIER=35,_WORLDMAP_LOCATION_LABEL_WIDTH=100,_WORLDMAP_MESSAGE_SHOW_TIME=2e3,_WORLDMAP_MESSAGE_DIM_INTERVAL=100,_worldmapMessageFirstFreeId=1e4,MOUSE_DRAG_MODIFIER=1;__firstFreeWorldmapObjectId=1;var _allWorldmapObjects={};WENGINE_DEFAULT_LINE_WIDTH=1,window.initQueue.push(function(){setTimeout(function(){var t=getWorldmapViewRectangle(),e=30;t.x+=e,t.y+=e,t.width-=2*e+WENGINE_DEFAULT_LINE_WIDTH,t.height-=2*e+WENGINE_DEFAULT_LINE_WIDTH,t.width/=getWorldmapZoom(),t.height/=getWorldmapZoom(),paintTest()},160)});var testLineX1,testLineY1,testLineX2,testLineY2;__firstFreeWorldmapObjectHtmlElementId=100;var _WORLDMAP_IMAGE_INITIAL_WIDTH=3500,_WORLDMAP_IMAGE_INITIAL_X=1e3,_WORLDMAP_IMAGE_INITIAL_Y=1e3,_worldmapViewRectangle=null,_currentWorldmapImageWidth=null,_currentWorldmapImageHeight=null,_WORLDMAP_ZOOM_INTERVAL=15,_WORLDMAP_ZOOM_ANIMATIONS=25,_worldmapZoomsToProceedCounter=0,_MIN_ZOOM_VALUE=.58,_zoomStep=50,_zoom,_zoomMessageWasShown=!1,_oldMapImageWidth=null,_oldZoom=null,_oldWorldmapViewRectangle={x:0,y:0,width:0,height:0},WORLDMAP_WIDTH=3500,WORLDMAP_HEIGHT=3500;window.initQueue.push(function(){setTimeout(function(){initializeWorldmap(),initializeWorldmapView(),initializeWorldmapLocations(),initializeWorldmapEvents()},80)});var WORLDMAP_CANVAS_WIDTH=null,WORLDMAP_CANVAS_HEIGHT=null,WORLDMAP_CANVAS_MARGIN_LEFT=null,WORLDMAP_CANVAS_MARGIN_TOP=null,worldmap=null;