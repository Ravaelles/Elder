function isDefined(e){return"undefined"!=typeof e}function isUndefined(e){return"undefined"==typeof e}function cloneObject(e){return JSON.parse(JSON.stringify(e))}function getMapCoordinatesFromScreenClick(e){var t=e.pageX-WORLDMAP_CANVAS_MARGIN_LEFT,o=e.pageY-WORLDMAP_CANVAS_MARGIN_TOP;return getMapCoordinatesFromCanvasCoordinates(t,o)}function getMapCoordinatesFromCanvasCoordinates(e,t){var o=getMapOffsetPixelsX()*getWorldmapZoom(),a=WORLDMAP_CANVAS_WIDTH*getWorldmapZoom(),n=e/WORLDMAP_CANVAS_WIDTH,i=getMapOffsetPixelsY()*getWorldmapZoom(),r=WORLDMAP_CANVAS_HEIGHT*getWorldmapZoom(),s=t/WORLDMAP_CANVAS_HEIGHT,l=parseInt(o+n*a),m=parseInt(i+s*r);return{mapX:l,mapY:m}}function getCanvasCoordinatesFromMapCoordinates(e,t){return{canvasX:WORLDMAP_CANVAS_MARGIN_LEFT+e/getWorldmapZoom()-getMapOffsetPixelsX()+2,canvasY:WORLDMAP_CANVAS_MARGIN_TOP+t/getWorldmapZoom()-getMapOffsetPixelsY()+1}}function getCurrentTopLeftPointMapCoordinates(){return getMapCoordinatesFromCanvasCoordinates(0,0)}function coordinatesToString(e){return"canvasX"in e?"["+e.canvasX+","+e.canvasY+"]":"["+e.mapX+","+e.mapY+"]"}function HtmlElement(e,t){this._id=null,this._selector=null,this._top=null,this._left=null,this._htmlDOM=null,this._styleString=null,this._htmlString=null,this.constructor=function(e,t){this._id=__firstFreeWorldmapElementId++,this._htmlDOM=document.createElement("div"),this._left=e,this._top=t},this.constructor(e,t),this.getId=function(){return this._id},this.getSelector=function(){return null===this._selector&&(this._selector=$("#html-element-"+this._id)),this._selector},this.setStyle=function(e){this._styleString=e,this._htmlDOM.setAttribute("id","html-element-"+this._id),this._htmlDOM.setAttribute("style",e)},this.getHtml=function(){return null===this._htmlString&&this.prepareHtml(),this._htmlString},this.prepareHtml=function(){this.updateHtmlDOMPosition(),this._htmlString=this._htmlDOM.outerHTML},this.updateHtmlDOMPosition=function(){var e=this._styleString;e+="top:"+this._top+"px;",e+="left:"+this._left+"px;",this._htmlDOM.setAttribute("style",e)},this.translate=function(e,t){this._left+=e,this._top+=t,this.getSelector().css({left:this._left+"px",top:this._top+"px"})}}function initializeWorldmapEvents(){$(".worldmap-location").mousedown(function(e){mapMouseDown(e),e.stopPropagation()}).mouseup(function(e){mapMouseUp(e),e.stopPropagation()}).mousemove(function(e){mapMouseMove(e),e.stopPropagation()}),$(".worldmap").mousedown(function(e){mapMouseDown(e)}).mouseup(function(e){mapMouseUp(e)}).mousemove(function(e){mapMouseMove(e)}).mousewheel(function(e){mapScroll(e)}).mouseleave(function(e){mapMouseLeave(e)}).contextmenu(function(e){FORBID_RIGHT_CLICK&&e.preventDefault()})}function mapMouseDown(e){worldmap=$(".worldmap"),2===e.button,mousePreviousPosition=e,mouseIsClicked=!0,mouseHasMoved=!1}function mapMouseUp(e){mouseHasMoved||mapClick(e),mouseIsClicked=!1,mousePreviousPosition=null,mouseHasMoved=!1}function mapMouseMove(e){mouseIsClicked&&(mouseHasMoved=!0),mouseIsClicked&&null!=mousePreviousPosition&&(translationVector=moveWorldmapBackgroundImage(e),moveWorldmapObjects(translationVector)),mousePreviousPosition=e,worldmapMessageForever("Mouse points to "+coordinatesToString(getMapCoordinatesFromScreenClick(e)),"mouse-cords")}function mapScroll(e){var t=e.deltaY;t>=1?changeZoom(e,!1):-1>=t&&changeZoom(e,!0),mapMouseMove(e)}function mapMouseLeave(e){mouseIsClicked&&(mapMouseUp(e),mouseIsClicked=!1)}function mapClick(e){var t=getMapCoordinatesFromScreenClick(e);gameLog("<span>["+t.mapX+","+t.mapY+"]</span> is unknown wasteland, not very hospitable place.")}function initializeWorldmapLocations(){recalculateWorldmapLocationVariables(),worldmapLocations.forEach(function(e,t){getWorldmap().append(createHtmlFromLocationJson(e,t))})}function createHtmlFromLocationJson(e,t){var o=e._id,a=e.name,n=getCanvasCoordinatesFromMapCoordinates(e.location.x,e.location.y),i="top:"+(n.canvasY-WORLDMAP_LOCATION_SIZE/2)+"px;left:"+(n.canvasX-WORLDMAP_LOCATION_SIZE/2)+"px;width:"+WORLDMAP_LOCATION_SIZE+"px;height:"+WORLDMAP_LOCATION_SIZE+"px",r="margin-top:"+WORLDMAP_LOCATION_LABEL_MARGIN_TOP+"px;margin-left:"+WORLDMAP_LOCATION_LABEL_MARGIN_LEFT+"px";return'<div class="worldmap-location" id="worldmap-location-'+o+'" variableName="worldmapLocations" variableIndex="'+t+'" style="'+i+'"><label style="'+r+'">'+a+"</label></div>"}function recalculateWorldmapLocationVariables(){WORLDMAP_LOCATION_SIZE=_WORLDMAP_LOCATION_SIZE_MODIFIER/getWorldmapZoom(),WORLDMAP_LOCATION_BORDER_WIDTH=1.5,WORLDMAP_LOCATION_LABEL_MARGIN_TOP=_WORLDMAP_LOCATION_SIZE_MODIFIER/getWorldmapZoom()*1.02,WORLDMAP_LOCATION_LABEL_MARGIN_LEFT=-_WORLDMAP_LOCATION_LABEL_WIDTH/2+WORLDMAP_LOCATION_SIZE/2-WORLDMAP_LOCATION_BORDER_WIDTH+1}function gameLog(e){$(".game-log p").css("opacity","0.7"),$(".game-log").prepend("<p style='display: none' class='game-log-invisible'><span class='dot'>â€¢</span> "+e+"</p>"),$(".game-log .game-log-invisible").slideDown(700)}function worldmapMessageForever(e,t,o){return"undefined"!=typeof t?worldmapMessage(e,o,t):void 0}function worldmapMessage(e,t,o){t&&(t="color: "+t);var a="game-message-"+(isDefined(o)?o:_worldmapMessageFirstFreeId++);if(o){var n=$("#"+a);if(n.length>0)return void n.text(e)}$(".game-messages").append("<div class='game-message' id='"+a+"' style='width: "+WORLDMAP_CANVAS_WIDTH+"px;"+t+";opacity:1.0'>"+e+"</div>"),o||setTimeout(function(){_dimMessageWithTime(a)},_WORLDMAP_MESSAGE_SHOW_TIME)}function _dimMessageWithTime(e){var t=$("#"+e),o=t.css("opacity");if(0>=o){var a=400;t.hide(a),setTimeout(function(){t.remove()},a)}else t.css("opacity",t.css("opacity")-.03),setTimeout(function(){_dimMessageWithTime(e)},_WORLDMAP_MESSAGE_DIM_INTERVAL+100*o)}function moveWorldmapBackgroundImage(e,t){if(isUndefined(t))var o=e.pageX-mousePreviousPosition.pageX,a=e.pageY-mousePreviousPosition.pageY;else var o=e,a=t;var n=-1*getMapOffsetPixelsX(),i=-1*getMapOffsetPixelsY();if(deltaImagePosX=o,deltaImagePosY=a,n+=deltaImagePosX,i+=deltaImagePosY,imagePosXWithScreenWidth=n-WORLDMAP_CANVAS_WIDTH,imagePosYWithScreenHeight=i-WORLDMAP_CANVAS_HEIGHT,n>0){var r=n;n=0,deltaImagePosX-=r-n}else if(imagePosXWithScreenWidth<=-WORLDMAP_WIDTH/getWorldmapZoom()){var r=n;n=-WORLDMAP_WIDTH/getWorldmapZoom()+WORLDMAP_CANVAS_WIDTH,deltaImagePosX-=r-n}if(i>0){var s=i;i=0,deltaImagePosY-=s-i}else if(imagePosYWithScreenHeight<=-WORLDMAP_HEIGHT/getWorldmapZoom()){var s=i;i=-WORLDMAP_HEIGHT/getWorldmapZoom()+WORLDMAP_CANVAS_HEIGHT,deltaImagePosY-=s-i}return updateViewRectangle(-1*n,-1*i),{dx:deltaImagePosX,dy:deltaImagePosY}}function moveWorldmapObjects(e){var t=getAllWorldmapObjects();for(var o in t)var a=t[o];var n=$(".worldmap-location");$.each(n,function(t,o){var a=$("#"+o.id);a.css({top:parseFloat(a.css("top"))+e.dy,left:parseFloat(a.css("left"))+e.dx})}),$.each(_allWorldmapObjects,function(t,o){o.translate(e.dx,e.dy)})}function WorldmapObject(e){this._id=null,this._x=null,this._y=null,this._x2=null,this._y2=null,this._htmlElements=[],this.constructor=function(e){this._id=__firstFreeWorldmapObjectId++;for(var t in e){var o=e[t];t="_"+t,this.fieldName=o}},this.constructor(e),this.getId=function(){return this._id},this.addHtmlElement=function(e){var t=e.getId();return this._htmlElements[t]=e,this},this.getHtmlElements=function(){return this._htmlElements.slice()},this.setCoordinates=function(e,t){return this._x=e,this._y=t,this},this.setEndCoordinates=function(e,t){return this._x2=e,this._y2=t,this},this.getCoordinates=function(){return{x:this._x,y:this._y}},this.translate=function(e,t){this._x+=e,this._y+=t;for(var o in this._htmlElements){var a=this._htmlElements[o];a.translate(e,t)}}}function getAllWorldmapObjects(){return _allWorldmapObjects}function addWorldmapObject(e){var t=e.getHtmlElements();for(var o in t){var a=t[o];getWorldmap().append(a.getHtml())}_allWorldmapObjects[e.getId()]=e}function paintTest(){testLineX1=_WORLDMAP_IMAGE_INITIAL_X+300,testLineY1=_WORLDMAP_IMAGE_INITIAL_Y+400,testLineX2=testLineX1,testLineY2=testLineY1;WEngine_paintLine(testLineX1,testLineY1,testLineX2,testLineY2);setTimeout(function(){},100)}function WEngine_paintLine(e,t,o,a,n,i){canvasCoords=getCanvasCoordinatesFromMapCoordinates(e,t),e=canvasCoords.canvasX,t=canvasCoords.canvasY,canvasCoords=getCanvasCoordinatesFromMapCoordinates(o,a),o=canvasCoords.canvasX,a=canvasCoords.canvasY;var r=_WEngine_getLine(e,t,o,a,n);return isUndefined(i)?(i=new WorldmapObject,i.setCoordinates(e,t),i.setEndCoordinates(o,a),i.addHtmlElement(r),addWorldmapObject(i),i):r}function WEngine_paintRectangleFromArray(e,t){return WEngine_paintRectangle(e.x,e.y,e.x+e.width,e.y+e.height,t)}function WEngine_paintRectangle(e,t,o,a,n){var i=new WorldmapObject;return i.setCoordinates(e,t),i.setEndCoordinates(o,a),i.addHtmlElement(WEngine_paintLine(e,t,o,t,n,i)),i.addHtmlElement(WEngine_paintLine(e,a,o,a,n,i)),i.addHtmlElement(WEngine_paintLine(e,t,e,a,n,i)),i.addHtmlElement(WEngine_paintLine(o,t,o,a,n,i)),addWorldmapObject(i),i}function _WEngine_getLine(e,t,o,a,n){var i=e-o,r=t-a,s=Math.sqrt(i*i+r*r),l=(e+o)/2,m=(t+a)/2,_=l-s/2,d=m,p=Math.PI-Math.atan2(-r,i);return _WEngine_getLine_element(_,d,s,p,n)}function _WEngine_getLine_element(e,t,o,a,n){var i=new HtmlElement(e,t),r="border: "+WENGINE_DEFAULT_LINE_WIDTH+"px dashed red; width: "+o+"px; height: 0px; -moz-transform: rotate("+a+"rad); -webkit-transform: rotate("+a+"rad); -o-transform: rotate("+a+"rad); -ms-transform: rotate("+a+"rad); position: absolute; ";if(isDefined(n))for(var s in n)r+=s+":"+n[s]+";";return i.setStyle(r),i}function initializeWorldmapView(){_currentWorldmapImageWidth=_WORLDMAP_IMAGE_INITIAL_WIDTH,_currentWorldmapImageHeight=_currentWorldmapImageWidth*WORLDMAP_CANVAS_WIDTH/WORLDMAP_CANVAS_HEIGHT,_worldmapViewRectangle={x:_WORLDMAP_IMAGE_INITIAL_X,y:_WORLDMAP_IMAGE_INITIAL_Y,width:WORLDMAP_CANVAS_WIDTH,height:WORLDMAP_CANVAS_HEIGHT},initializeWorldmapZoom(),updateViewRectangle(_worldmapViewRectangle.x,_worldmapViewRectangle.y)}function getWorldmapViewRectangle(){return cloneObject(_worldmapViewRectangle)}function getWorldmapViewRectangleWidth(){return _worldmapViewRectangle.width}function getWorldmapViewRectangleHeight(){return _worldmapViewRectangle.height}function getMapOffsetPixelsX(){return _worldmapViewRectangle.x}function getMapOffsetPixelsY(){return _worldmapViewRectangle.y}function updateViewRectangle(e,t){if(isDefined(e)){var o,a;null!=e?(o=Math.abs(e),a=Math.abs(t)):(o=Math.abs(e.x),a=Math.abs(t.y)),_worldmapViewRectangle.x=o,_worldmapViewRectangle.y=a,getWorldmap().css({"background-position":-o+"px "+-a+"px"})}_worldmapViewRectangle.width=WORLDMAP_CANVAS_WIDTH/getWorldmapZoom(),_worldmapViewRectangle.height=WORLDMAP_CANVAS_HEIGHT/getWorldmapZoom(),getWorldmap().css({"background-size":_currentWorldmapImageWidth+"px auto"})}function initializeWorldmapZoom(){_recalculateZoom()}function getWorldmapZoom(){return _zoom}function changeZoom(e,t){_zoomMessageWasShown=!1,_worldmapZoomsToProceedCounter=_WORLDMAP_ZOOM_ANIMATIONS,_delayChangeZoom(e,t)}function _delayChangeZoom(e,t){setTimeout(function(){_processZoom(e,t)},_WORLDMAP_ZOOM_INTERVAL)}function _processZoom(e,t){if(_worldmapZoomsToProceedCounter>0){if(_worldmapZoomsToProceedCounter--,_oldMapImageWidth=_currentWorldmapImageWidth,_oldZoom=_zoom,_oldWorldmapViewRectangle=getWorldmapViewRectangle(),!_changeZoomAndCheckIfAllowed(e,t))return _revertZoom();updateViewRectangle(),_afterZoomMakeSureWeReInbound(e,t),_afterZoomUpdateMapLocations(),mapMouseMove(e),_delayChangeZoom(e,t)}}function _afterZoomMakeSureWeReInbound(e,t){var o=getCurrentTopLeftPointMapCoordinates(),a=(o.mapX-_oldWorldmapViewRectangle.x,o.mapY-_oldWorldmapViewRectangle.y,2);t?moveWorldmapBackgroundImage(_zoomStep/a,_zoomStep/a):moveWorldmapBackgroundImage(_zoomStep/-a,_zoomStep/-a)}function _afterZoomUpdateMapLocations(){recalculateWorldmapLocationVariables();var e=$(".worldmap-location");$.each(e,function(e,t){var o=$("#"+t.id),a=o.attr("variableName"),n=o.attr("variableIndex"),i=window[a][n],r=getCanvasCoordinatesFromMapCoordinates(i.location.x,i.location.y);o.css({width:WORLDMAP_LOCATION_SIZE+"px",height:WORLDMAP_LOCATION_SIZE+"px",left:r.canvasX-WORLDMAP_LOCATION_SIZE/2,top:r.canvasY-WORLDMAP_LOCATION_SIZE/2,"border-width":WORLDMAP_LOCATION_BORDER_WIDTH+"px"})}),$(".worldmap-location label").css({"margin-top":WORLDMAP_LOCATION_LABEL_MARGIN_TOP+"px","margin-left":WORLDMAP_LOCATION_LABEL_MARGIN_LEFT+"px"})}function _recalculateZoom(){_zoom=WORLDMAP_WIDTH/_currentWorldmapImageWidth}function _changeZoomAndCheckIfAllowed(e,t){t?_currentWorldmapImageWidth-=_zoomStep:_currentWorldmapImageWidth+=_zoomStep,_recalculateZoom();var o=_MIN_ZOOM_VALUE>_zoom,a=WORLDMAP_CANVAS_WIDTH>_currentWorldmapImageWidth;return o?(worldmapMessage("Maximum zoom reached!","#f35"),_zoomMessageWasShown=!0,!1):a?(worldmapMessage("Maximum zoom out reached!","#2f3"),_zoomMessageWasShown=!0,!1):!0}function _revertZoom(){_currentWorldmapImageWidth=_oldMapImageWidth,_zoom=_oldZoom,_worldmapViewRectangle=_oldWorldmapViewRectangle}function initializeWorldmap(){WORLDMAP_CANVAS_WIDTH=$(".worldmap").width(),WORLDMAP_CANVAS_HEIGHT=$(".content-wrapper").height(),WORLDMAP_CANVAS_MARGIN_LEFT=$(".sidebar").width(),WORLDMAP_CANVAS_MARGIN_TOP=$(".main-header").height();$(".worldmap");getWorldmap().css("background-image",'url("/img/map/map.jpg")')}function getWorldmap(){return null!=worldmap?worldmap:worldmap=$(".worldmap")}__firstFreeWorldmapElementId=1;var FORBID_RIGHT_CLICK=!1,mouseIsClicked=!1,mousePreviousPosition=null,mouseHasMoved=!1,WORLDMAP_LOCATION_SIZE=null,WORLDMAP_LOCATION_LABEL_MARGIN_LEFT=null,WORLDMAP_LOCATION_LABEL_MARGIN_TOP=null,_WORLDMAP_LOCATION_SIZE_MODIFIER=35,_WORLDMAP_LOCATION_LABEL_WIDTH=100,_WORLDMAP_MESSAGE_SHOW_TIME=2e3,_WORLDMAP_MESSAGE_DIM_INTERVAL=100,_worldmapMessageFirstFreeId=1e4,MOUSE_DRAG_MODIFIER=1;__firstFreeWorldmapObjectId=1;var _allWorldmapObjects={};WENGINE_DEFAULT_LINE_WIDTH=1,window.initQueue.push(function(){setTimeout(function(){var e=getWorldmapViewRectangle(),t=30;e.x+=t,e.y+=t,e.width-=2*t+WENGINE_DEFAULT_LINE_WIDTH,e.height-=2*t+WENGINE_DEFAULT_LINE_WIDTH,e.width/=getWorldmapZoom(),e.height/=getWorldmapZoom(),paintTest()},160)});var testLineX1,testLineY1,testLineX2,testLineY2;__firstFreeWorldmapObjectHtmlElementId=100;var _WORLDMAP_IMAGE_INITIAL_WIDTH=3500,_WORLDMAP_IMAGE_INITIAL_X=1e3,_WORLDMAP_IMAGE_INITIAL_Y=1e3,_worldmapViewRectangle=null,_currentWorldmapImageWidth=null,_currentWorldmapImageHeight=null,_WORLDMAP_ZOOM_INTERVAL=15,_WORLDMAP_ZOOM_ANIMATIONS=25,_worldmapZoomsToProceedCounter=0,_MIN_ZOOM_VALUE=.58,_zoomStep=50,_zoom,_zoomMessageWasShown=!1,_oldMapImageWidth=null,_oldZoom=null,_oldWorldmapViewRectangle={x:0,y:0,width:0,height:0},WORLDMAP_WIDTH=3500,WORLDMAP_HEIGHT=3500;window.initQueue.push(function(){setTimeout(function(){initializeWorldmap(),initializeWorldmapView(),initializeWorldmapLocations(),initializeWorldmapEvents()},80)});var WORLDMAP_CANVAS_WIDTH=null,WORLDMAP_CANVAS_HEIGHT=null,WORLDMAP_CANVAS_MARGIN_LEFT=null,WORLDMAP_CANVAS_MARGIN_TOP=null,worldmap=null;